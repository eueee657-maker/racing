function myFunction() {
  /**
 * ì›¹ ì•±ì˜ ë©”ì¸ í˜ì´ì§€ë¥¼ ì„œë¹„ìŠ¤í•©ë‹ˆë‹¤.
 * @param {Object} e - ì´ë²¤íŠ¸ ê°ì²´ (Apps Scriptì— ì˜í•´ ìë™ ì „ë‹¬ë¨)
 * @return {GoogleAppsScript.HTML.HtmlOutput}
 */
function doGet(e) {
  // HTML íŒŒì¼ì„ í…œí”Œë¦¿ìœ¼ë¡œ ë¡œë“œí•˜ê³  ì•± ì„¤ì •ì„ ì§€ì •í•©ë‹ˆë‹¤.
  return HtmlService.createTemplateFromFile('index').evaluate()
      .setTitle('ê²½ë§ˆ ë² íŒ… ì‹œë®¬ë ˆì´ì…˜')
      .setFaviconUrl('https://placehold.co/16x16/000000/ffffff?text=ğŸ‡')
      .addMetaTag('viewport', 'width=device-width, initial-scale=1');
}

/**
 * ì´ˆê¸° ê²½ì£¼ë§ˆ ë°ì´í„°ì™€ ë°°ë‹¹ë¥ ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
 * ê²½ì£¼ë§ˆë¥¼ ì¼ë³¸ì˜ ìœ ëª… ìš°ìŠ¹ë§ˆ 8ë§ˆë¦¬ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.
 * @return {Array<Object>} ê²½ì£¼ë§ˆ ì •ë³´ ë°°ì—´
 */
function getInitialData() {
  // ì¼ë³¸ì˜ ì „ì„¤ì ì¸ G1 ìš°ìŠ¹ë§ˆ ëª©ë¡ ë° ë°°ë‹¹ë¥  ì„¤ì • (ì´ 8ë§ˆë¦¬)
  const horses = [
    // ë‚®ì€ ë°°ë‹¹ë¥  (ìœ ë ¥ ìš°ìŠ¹ë§ˆ)
    { id: 1, name: "ë”¥ ì„íŒ©íŠ¸", odds: 2.0 },        // Deep Impact (íŠ¸ë¦¬í”Œ í¬ë¼ìš´, ì „ì„¤ì ì¸ ëª…ë§ˆ)
    { id: 2, name: "ì•„ëª¬ë“œ ì•„ì´", odds: 3.0 },      // Almond Eye (G1 ìµœë‹¤ìŠ¹ ê¸°ë¡ ë³´ìœ )
    { id: 3, name: "ì‹¬ë³¼ë¦¬ ë£¨ëŒí”„", odds: 4.5 },    // Symboli Rudolf (ìµœì´ˆ ë¬´íŒ¨ íŠ¸ë¦¬í”Œ í¬ë¼ìš´)
    { id: 4, name: "ì˜¤ë¥´í˜ë¸Œë¥´", odds: 6.0 },        // Orfevre (íŠ¸ë¦¬í”Œ í¬ë¼ìš´, ì•„ë¦¬ë§ˆ ê¸°ë… 2íšŒ)
    
    // ì¤‘ê°„ ë°°ë‹¹ë¥ 
    { id: 5, name: "ì  í‹¸ëˆë‚˜", odds: 10.0 },       // Gentildonna (ì¬íŒ¬ ì»µ 2íšŒ ìš°ìŠ¹)
    { id: 6, name: "ë¡œë“œ ì¹´ë‚ ë¡œì•„", odds: 15.0 },   // Lord Kanaloa (ë‹¨ê±°ë¦¬ ì±”í”¼ì–¸)
    
    // ë†’ì€ ë°°ë‹¹ë¥  (ëŒ€ì´ë³€ ê°€ëŠ¥ì„±)
    { id: 7, name: "ê³¨ë“œ ì‰½", odds: 20.0 },         // Gold Ship (G1 6ìŠ¹, ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ëª…ë§ˆ)
    { id: 8, name: "ì´í€´ë…¹ìŠ¤", odds: 25.0 }          // Equinox (ìµœê·¼ ì„¸ê³„ ë­í‚¹ 1ìœ„, ê³ ë°°ë‹¹ë§ˆ)
  ];
  return horses;
}

/**
 * ê²½ì£¼ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ê³  ê²°ê³¼ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
 * @param {object} betData - { horseId: number, betAmount: number } ë² íŒ… ë°ì´í„°
 * @return {object} - { winnerId: number, winnerName: string, winnerOdds: number, resultAmount: number, isWin: boolean, error: string? } ê²°ê³¼ ê°ì²´
 */
function simulateRace(betData) {
  const horses = getInitialData();
  const selectedHorse = horses.find(h => h.id === betData.horseId);
  
  if (!selectedHorse || betData.betAmount <= 0) {
    return { error: "ìœ íš¨í•˜ì§€ ì•Šì€ ë² íŒ…ì…ë‹ˆë‹¤." };
  }

  // --- ì‹œë®¬ë ˆì´ì…˜: ë°°ë‹¹ë¥ ì— ë°˜ë¹„ë¡€í•˜ëŠ” í™•ë¥ ë¡œ ìŠ¹ì ê²°ì • ---
  // ë‚®ì€ ë°°ë‹¹ë¥ (ìœ ë ¥ ìš°ìŠ¹ë§ˆ)ì¼ìˆ˜ë¡ ë‹¹ì²¨ í™•ë¥ ì´ ë†’ë„ë¡ ê°€ì¤‘ì¹˜ë¥¼ ì ìš©í•©ë‹ˆë‹¤.
  const totalInverseOdds = horses.reduce((sum, h) => sum + (1 / h.odds), 0);
  
  let random = Math.random() * totalInverseOdds;
  let winner = null;
  
  for (const horse of horses) {
    const inverseOdds = 1 / horse.odds;
    if (random < inverseOdds) {
      winner = horse;
      break;
    }
    random -= inverseOdds;
  }
  
  // ë¶€ë™ì†Œìˆ˜ì  ë¬¸ì œë¡œ ìŠ¹ìê°€ ê²°ì •ë˜ì§€ ì•Šì„ ê²½ìš° ë§ˆì§€ë§‰ ë§ì„ ìŠ¹ìë¡œ ì§€ì • (ì•ˆì „ì¥ì¹˜)
  if (!winner) {
    winner = horses[horses.length - 1];
  }

  // --- ê²°ê³¼ ê³„ì‚° ---
  const isWin = (winner.id === selectedHorse.id);
  let resultAmount = 0; // ìˆœìˆ˜ ì†ìµ (ë² íŒ…ì•¡ ì œì™¸í•œ ì´ìµ ë˜ëŠ” ì†ì‹¤)

  if (isWin) {
    // ìŠ¹ë¦¬: (ë² íŒ…ì•¡ * ë°°ë‹¹ë¥ ) - ë² íŒ…ì•¡ = ìˆœìˆ˜ ì´ìµ
    resultAmount = (betData.betAmount * selectedHorse.odds) - betData.betAmount;
  } else {
    // íŒ¨ë°°: ë² íŒ…ì•¡ë§Œí¼ ì†í•´
    resultAmount = -betData.betAmount;
  }

  return {
    winnerId: winner.id,
    winnerName: winner.name,
    winnerOdds: winner.odds,
    isWin: isWin,
    resultAmount: resultAmount // ìˆœìˆ˜ ì†ìµ ê¸ˆì•¡
  };
}

}
